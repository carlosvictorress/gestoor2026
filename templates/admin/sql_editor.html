{% extends 'base.html' %}

{% block content %}
<div class="container-fluid animate__animated animate__fadeIn">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="bi bi-terminal-fill text-primary"></i> SQL Console Administrativo</h2>
        <span class="badge bg-danger">Acesso Restrito: Admin</span>
    </div>

    <div class="card border-0 shadow-sm mb-4" style="border-radius: 15px;">
        <div class="card-body">
            <form id="sqlForm" method="POST">
                <div id="editor" style="height: 250px; border-radius: 10px; font-size: 14px;">{{ sql_query }}</div>
                <input type="hidden" name="sql_query" id="sql_query">
                
                <div class="mt-3 d-flex justify-content-end">
                    <button type="submit" class="btn btn-primary px-5 shadow-sm">
                        <i class="bi bi-play-circle-fill me-2"></i>Executar Query
                    </button>
                </div>
            </form>
        </div>
    </div>

    {% if error %}
    <div class="alert bg-white border-start border-danger border-4 shadow-sm animate__animated animate__shakeX">
        <code class="text-danger small">{{ error }}</code>
    </div>
    {% endif %}

    {% if query_result %}
    <div class="card border-0 shadow-sm mt-4 animate__animated animate__fadeInUp">
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead class="table-light">
                    <tr>
                        {% for col in query_result.columns %}
                        <th class="text-uppercase small fw-bold">{{ col }}</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for row in query_result.rows %}
                    <tr>
                        {% for cell in row %}
                        <td class="small">{{ cell }}</td>
                        {% endfor %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.js"></script>
<script>
    var editor = ace.edit("editor");
    editor.setTheme("ace/theme/tomorrow_night_eighties");
    editor.session.setMode("ace/mode/sql");
    document.getElementById('sqlForm').onsubmit = function() {
        document.getElementById('sql_query').value = editor.getValue();
    };
</script>
{% endblock %}