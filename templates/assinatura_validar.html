<!doctype html>
<html lang="pt-br">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Validação de Documento Oficial</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    
    <style>
        body {
            background-color: #f0f2f5;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .main-card {
            max-width: 700px;
            margin: 5vh auto;
            border: none;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .card-header {
            background-color: #003366; /* Azul Institucional */
            color: white;
            padding: 2rem;
            text-align: center;
        }
        .result-box {
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid #dee2e6;
        }
        .valid-box {
            background-color: #f0fff4;
            border-color: #c6f6d5;
            color: #2f855a;
        }
        .invalid-box {
            background-color: #fff5f5;
            border-color: #fed7d7;
            color: #c53030;
        }
        .info-label {
            font-weight: bold;
            color: #555;
            font-size: 0.9rem;
            text-transform: uppercase;
        }
        .info-value {
            font-size: 1.1rem;
            color: #222;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="card main-card">
        <div class="card-header">
            <h2 class="h4 mb-0">Verificador de Autenticidade</h2>
            <p class="small opacity-75 mb-0">Portal de Transparência e Validação Digital</p>
        </div>
        
        <div class="card-body p-4 p-md-5">
            
            <form method="POST" action="{{ url_for('assinatura.validar_assinatura_publica') }}">
                <label class="form-label fw-bold text-secondary">Código de Validação</label>
                <div class="input-group input-group-lg mb-2">
                    <span class="input-group-text bg-white"><i class="bi bi-qr-code"></i></span>
                    <input type="text" class="form-control" 
                           placeholder="Ex: a1b2-012025-semed-2025" 
                           name="codigo" 
                           value="{{ codigo_buscado or '' }}" 
                           required>
                    <button class="btn btn-primary" type="submit">
                        Verificar
                    </button>
                </div>
                <div class="form-text">O código encontra-se no rodapé do documento assinado (Selagem).</div>
            </form>

            {% if resultado %}
                <hr class="my-4">

                {% if resultado.status == 'VÁLIDO' %}
                    <div class="result-box valid-box text-center animate-fade-in">
                        <i class="bi bi-check-circle-fill display-1 mb-3"></i>
                        <h3 class="h4 fw-bold">DOCUMENTO VÁLIDO</h3>
                        <p class="mb-0">A autenticidade deste documento foi confirmada em nossa base de dados.</p>
                    </div>

                    <div class="mt-4">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="info-label">Documento Original</div>
                                <div class="info-value"><i class="bi bi-file-earmark-pdf text-danger"></i> {{ resultado.documento }}</div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="info-label">Assinado Por</div>
                                <div class="info-value">{{ resultado.emitido_por }}</div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="info-label">Data da Assinatura</div>
                                <div class="info-value">{{ resultado.data_assinatura }}</div>
                            </div>

                            <div class="col-md-6">
                                <div class="info-label">Cargo / Função</div>
                                <div class="info-value">{{ resultado.cargo }}</div>
                            </div>

                            <div class="col-md-6">
                                <div class="info-label">Lotação</div>
                                <div class="info-value">{{ resultado.lotacao }}</div>
                            </div>
                        </div>
                        
                        <div class="alert alert-light border mt-3 text-center small text-muted">
                            Código Hash: <strong>{{ resultado.codigo }}</strong>
                        </div>
                    </div>

                {% elif resultado.status == 'ARQUIVO_AUSENTE' %}
                    <div class="result-box bg-warning bg-opacity-10 border-warning text-center">
                        <i class="bi bi-exclamation-triangle-fill text-warning display-4 mb-3"></i>
                        <h3 class="h5 fw-bold text-warning-emphasis">REGISTRO ENCONTRADO, MAS ARQUIVO INDISPONÍVEL</h3>
                        <p class="mb-0 small">A assinatura é válida e consta no sistema, porém o arquivo PDF original não está mais disponível no servidor para download/conferência.</p>
                        <hr>
                        <p class="fw-bold mb-0">Assinante: {{ resultado.emitido_por }}</p>
                    </div>

                {% else %}
                    <div class="result-box invalid-box text-center">
                        <i class="bi bi-x-octagon-fill display-1 mb-3"></i>
                        <h3 class="h4 fw-bold">CÓDIGO INVÁLIDO</h3>
                        <p class="mb-0">Não foi encontrado nenhum documento com o código informado.</p>
                        <p class="mt-2 fw-bold text-dark">{{ codigo_buscado }}</p>
                    </div>
                    <div class="text-center mt-3">
                        <small class="text-muted">Verifique se digitou corretamente letras e números. O código é sensível a maiúsculas/minúsculas dependendo do sistema.</small>
                    </div>
                {% endif %}
            {% endif %}

        </div>
        <div class="card-footer text-center bg-light py-3">
            <small class="text-muted">&copy; {{ current_year }} Gestoor360 - Sistema de Gestão Pública</small>
        </div>
    </div>
</div>

</body>
</html>